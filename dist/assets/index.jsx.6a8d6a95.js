import{g as G,E as S,s as M,a as D,r as g,u as x,b as I,c as V,i as _,d as W,j as H,R as P}from"./jsx-runtime.ce3a7f6b.js";import{s as k,E as b,H as F,a as u,b as d,c as y,d as N,e as L,f,g as h,h as T,L as C,i as X,j as B,O as U,k as j,B as Y,l as $}from"./message.492f0669.js";const z=async()=>{const e=await G({type:"local",key:S});let t=null;return e[S]?t=e[S]:t=await k({type:b}),t?(M({type:"local",key:S,value:t}),new Map(JSON.parse(t).map(n=>[n.word,n]))):new Map([])},q=({value:e,words:t})=>{const n=e.replace(/[^a-z]/gi," ").split(" ").filter(c=>c&&t.has(c.toLowerCase()));return[...new Set(n)]},J=({config:e,nodeValue:t,matchedWords:n,words:c})=>{let l=t;return n.forEach(s=>{const a={config:e,orgWord:s,word:c.get(s.toLowerCase())};l=l.replace(s,D(a))}),l},K=e=>e.parentNode!=null&&e.parentNode.tagName!=="STYLE"&&e.parentNode.tagName!=="SCRIPT"&&e.parentNode.tagName!=="NOSCRIPT"&&!e.parentNode.classList.contains(F)&&!e.parentNode.classList.contains(u)&&!e.parentNode.classList.contains(d)&&!e.parentNode.classList.contains(y)&&!e.parentNode.classList.contains(N)&&!e.parentNode.classList.contains(L)&&!e.parentNode.classList.contains(f)&&e.nodeValue&&e.nodeValue.trim().length,Z=(e,t,n)=>{const c=new Map;let l=0;e.filter(s=>K(s)).forEach(s=>{const a=q({value:s.nodeValue,words:t});if(a.length){const o={config:n,nodeValue:s.nodeValue,matchedWords:a,words:t};c.set(l++,{parent:s.parentNode,orgValue:s.nodeValue,newValue:J(o)})}});for(const{parent:s,orgValue:a,newValue:o}of c.values())s.innerHTML=s.innerHTML.replace(a,o)},Q=()=>{const e=document.createElement("link");e.id="vocabulary-highlighter-icon",e.rel="stylesheet",e.href="https://fonts.googleapis.com/icon?family=Material+Icons",document.head.appendChild(e)},ee=()=>{const e=document.createElement("link");e.id="vocabulary-highlighter-font-style",e.rel="stylesheet",e.href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap",document.head.appendChild(e)},te=e=>e.parentNode!=null&&(e.parentNode.classList.contains(u)||e.parentNode.classList.contains(d)||e.parentNode.classList.contains(N)||e.parentNode.classList.contains(h)||e.parentNode.classList.contains(L)||e.parentNode.classList.contains(f)),se=e=>{let t=-1;return e.contains(u)?t=u:e.contains(d)?t=d:e.contains(h)?t=h:e.contains(L)?t=L:e.contains(f)&&(t=f),t},ae=(e,{language:t,showDetail:n,highlightColorClass:c,fontSizeClass:l})=>{const{parentNode:s}=e,{classList:a}=s,o=se(a);if(o===d){let r=s.parentNode;for(;!r.classList.contains(N);)r=r.parentNode;n?r.classList.remove(T):r.classList.add(T)}if(a.remove(...a),o===u)a.add(u),a.add(c);else if(o===d)a.add(d),a.add(l);else if(o===h)a.add(h),s.parentNode.classList.remove(...s.parentNode.classList),s.parentNode.classList.add(y),s.parentNode.classList.add(l);else if(o===L){a.add(L);const r=s.dataset[`${C[t].toLowerCase()}`]||s.dataset[C.en];e.nodeValue=r}else if(o===f){const{word:r}=s.dataset,E=`${U[t]}${r}`;a.add(f),s.href=E}},ne=(e,t)=>{const{highlightColor:n,language:c,fontSize:l,showDetail:s}=t,a=X[n],o=B[l];e.filter(r=>te(r)).forEach(r=>{ae(r,{language:c,showDetail:s,highlightColorClass:a,fontSizeClass:o})})},m=()=>{const e=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT);let t=e.currentNode,n=[];for(;t;)n=[...n,t],t=e.nextNode();return n},oe=()=>{const[e,t]=g.exports.useState({}),n=x(e),c=g.exports.useRef(-1),[l,s]=g.exports.useState(!0),a=async()=>{const i=m();if(i.length===c.current)return;const p=await z();c.current=i.length,Z(i,p,e)},o=async()=>{const p=(await G({type:"sync",key:I}))[I]||V();return _(p,e)||t(p),p},r=async()=>new Promise(i=>{ee(),Q(),i(!0)}),E=async()=>{await Promise.all([o(),r()]),s(!1)},w=async()=>{const i=await o();_(i,n)||ne(m(),i)},A=(i,p,v)=>(i.type===$&&(w(),v({payload:!0})),!0),O=()=>{Y.runtime.onMessage.addListener(A)};return g.exports.useEffect(()=>{if(l)return;a();const i=setInterval(()=>{a()},j);return()=>clearInterval(i)},[e]),g.exports.useEffect(()=>{E(),O()},[]),null};const R=document.createElement("div");R.id="cs-root";document.body.append(R);W.createRoot(document.getElementById("cs-root")).render(H(P.StrictMode,{children:H(oe,{})}));
